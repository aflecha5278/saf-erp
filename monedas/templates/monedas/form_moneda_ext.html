{% load widget_tweaks l10n %}
<div class="form-card">
    <div class="container-fluid">
		<div class="row g-3">
			<div class="col-md-3">
			    <label for="codmoneda" class="form-label">Moneda:</label>
				<select name="codmoneda" id="codmoneda" class="form-select input-cianova-sm">
					{% for m in monedas %}
					<option value="{{ m.codmoneda }}"
						data-cotiz="{{ m.cotiz|default:"0"|unlocalize }}"
						{% if form.initial.codmoneda == m.codmoneda %}selected{% endif %}>
						{{ m.codmoneda }} – {{ m.descrip }}
					</option>
					{% endfor %}
				</select>
			</div>	
			
			<!-- Cotización -->
			<div class="col-md-3">
			  <label for="cotiz" class="form-label">Cotización:</label>
			  <input type="text" name="cotiz" id="cotiz" class="form-control input-cianova-sm" value="{{ form.instance.cotiz|default_if_none:"0"|floatformat:5 }}" readonly>
			</div>

			<!-- Costo M.Ext. -->
			<div class="col-md-3">
			  {{ form.ctome.label_tag }}
			  {{ form.ctome|add_class:"form-control input-cianova-sm" }}
			</div>

			<!-- Venta M.Ext. -->
			<div class="col-md-3">
			  {{ form.vtame.label_tag }}
			  {{ form.vtame|add_class:"form-control input-cianova-sm" }}
			</div>

			<!-- Final M.Ext. -->
			<div class="col-md-3">
			  {{ form.finme.label_tag }}
			  {{ form.finme|add_class:"form-control input-cianova-sm" }}
			</div>
			<!-- Margen oculto desde page1 -->
			<input type="hidden" id="margen-hidden" value="{{ articulo.margen|default:0 }}">
			<!-- Alícuota oculta desde page1 -->
			<input type="hidden" id="alic-hidden" value="{{ articulo.alic|default:0 }}">
		</div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const monedaSelect = document.getElementById('codmoneda');
  const cotizInput   = document.querySelector('input[name="cotiz"]');

  function actualizarCotizacion() {
    const selected = monedaSelect?.options[monedaSelect.selectedIndex];
    const cotiz = parseFloat(selected?.dataset.cotiz) || 0;
    if (cotizInput) cotizInput.value = cotiz.toFixed(5);
  }

  monedaSelect?.addEventListener('change', actualizarCotizacion);

  // Inicializar cotización al cargar
  actualizarCotizacion();
});
</script>


