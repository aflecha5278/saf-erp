{% extends "base.html" %}
{% load widget_tweaks %}

{% block title %}Lista de Art√≠culos{% endblock %}

{% block content %}
<h2 class="mb-4">Lista de Art√≠culos</h2>

<a class="btn btn-institucional mb-3" href="{% url 'agregar_articulo' %}">Agregar Art√≠culo</a>

<form method="get" class="row g-2 mb-4 align-items-center">
  <div class="col-auto">
    <label for="buscar" class="form-label mb-0">Buscar:</label>
  </div>
  <div class="col-auto">
    <input type="text"
           name="q"
           id="buscar"
           class="form-control"
           value="{{ query }}"
           placeholder="C√ìDIGO O DESCRIPCI√ìN"
           maxlength="80"
           oninput="this.value = this.value.toUpperCase();">
  </div>
  <div class="col-auto">
    <button type="submit" class="btn btn-sm btn-primary">Buscar</button>
    {% if query %}
      <a href="{% url 'lista_articulos' %}" class="btn btn-sm btn-secondary ms-1">Limpiar</a>
    {% endif %}
  </div>
</form>

<table class="table table-striped table-bordered align-middle">
  <thead class="table-light">
    <tr>
      <th style="width: 120px;">C√≥digo</th>
      <th style="width: 35%;">Descripci√≥n</th>
	  <th style="text-end">Dep√≥sito</th>
	  <th style="text-end">Ubicaci√≥n</th>
	  <th class="text-end">Marca</th>
	  <th class="text-end">Precio Costo</th>
      <th class="text-end">Margen</th>
      <th class="text-end">Precio Venta</th>
      <th class="text-end">% Al√≠cuota</th>
      <th class="text-end">Costo con IVA</th>
      <th class="text-end">Precio Final</th>
	  <th class="text-end">Rubro</th>
	  <th class="text-end">Subrubro</th>
	  <th class="text-end">Cantidad</th>
	  <th class="text-end">U.medida</th>
	  <th class="text-end">Proveedor</th>
	  <th class="text-end">Stock m√≠nimo</th>
	  <th class="text-end">Observaciones</th>
	  <th class="text-end">Art. activo</th>
	  <th class="text-end">Tipo elaboraci√≥n</th>
	  <th class="text-end">Tipo peso</th>
	  <th style="width: 150px;">Acciones</th>
    </tr>
  </thead>
  <tbody>
  {% for articulo in articulos %}
  <tr>
    <td>{{ articulo.codart }}</td>
    <td>{{ articulo.descrip }}</td>
    <td>{{ articulo.deposito }}</td>
    <td>{{ articulo.ubicacion }}</td>
    <td>{{ articulo.marca }}</td>
    <td class="text-end">{{ articulo.precosto|floatformat:2 }}</td>
    <td class="text-end">{{ articulo.margen|floatformat:2 }}%</td>
    <td class="text-end">{{ articulo.preventa|floatformat:2 }}</td>
    <td class="text-end">{{ articulo.alic|floatformat:2 }}</td>
    <td class="text-end">{{ articulo.costoiva|floatformat:2 }}</td>
    <td class="text-end">{{ articulo.prefinal|floatformat:2 }}</td>
    <td>{{ articulo.rubro }}</td>
    <td>{{ articulo.subrubro }}</td>
    <td class="text-end">{{ articulo.cantidad|floatformat:0 }}</td>
    <td>{{ articulo.unimedi }}</td>
    <td>{{ articulo.codprovee }}</td>
    <td class="text-end">{{ articulo.bajostock|floatformat:0 }}</td>
	<td>
    {% if articulo.obs %}
		<details>
		<summary>üìù</summary>
		<div class="texto-obs">{{ articulo.obs }}</div>
		</details>
	{% else %}
		‚Äî
	{% endif %}
	<td>{{ articulo.activo }}</td>
	<td>{{ articulo.get_prodela_display }}</td>
	<td>{{ articulo.get_tipopeso_display }}</td>
	<td>
      <div class="btn-group" role="group">
        <a href="{% url 'modificar_articulo' articulo.id %}" class="btn btn-sm btn-institucional">
          <i class="bi bi-pencil-square"></i> Editar
        </a>
        <a href="{% url 'eliminar_articulo' articulo.id %}" 
           class="btn btn-sm btn-institucional-danger"
           onclick="return confirm('¬øEst√° seguro que desea eliminar el art√≠culo {{ articulo.descrip }}?');">
          <i class="bi bi-trash3"></i> Eliminar
        </a>
      </div>
    </td>
  </tr>
  {% empty %}
  <tr>
    <td colspan="19" class="text-center">No hay art√≠culos cargados.</td>
  </tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}



