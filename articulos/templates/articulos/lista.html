{% extends "articulos/base.html" %}
{% block title %}Lista de Artículos{% endblock %}

{% block content %}
<h2>Lista de Artículos</h2>
<a class="btn" href="{% url 'agregar_articulo' %}">Agregar Artículo</a>
<form method="get" class="mb-3">
  <label>Buscar:</label>
  <input type="text" name="q" value="{{ query }}" placeholder="Código o descripción">
  <button type="submit" class="btn btn-sm btn-primary">Buscar</button>
  {% if query %}
    <a href="{% url 'lista_articulos' %}" class="btn btn-sm btn-secondary">Limpiar</a>
  {% endif %}
</form>
<table>
    <thead>
        <tr>
            <th>Código</th>
            <th>Descripción</th>
            <th>Precio Costo</th>
            <th>Margen</th>
			<th>Precio Venta</th>
			<th>% Alícuota</th>
            <th>Costo con IVA</th>
            <th>Precio Final</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        {% for articulo in articulos %}
        <tr>
            <td>{{ articulo.codart }}</td>
            <td>{{ articulo.descrip }}</td>
            <td>{{ articulo.precosto|floatformat:2 }}</td>
			<td>{{ articulo.margen|floatformat:2 }}%</td>
			<td>{{ articulo.preventa }}</td>
			<td>{{ articulo.alic }}</td>
            <td>{{ articulo.costoiva }}</td>
            <td>
				{% if articulo.prefinal %}
					{{ articulo.prefinal|floatformat:2 }}
				{% else %}
					-
				{% endif %}
			</td>
            <td>
                <a href="{% url 'modificar_articulo' articulo.id %}">Editar</a>
                <a href="{% url 'eliminar_articulo' articulo.id %}" 
				   class="btn btn-danger"
				   onclick="return confirm('¿Está seguro que desea eliminar el artículo {{ articulo.descrip }}?');">
			       Eliminar
				</a>
			</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="7">No hay artículos cargados.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
