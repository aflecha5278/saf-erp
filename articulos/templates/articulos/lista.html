{% extends "articulos/base.html" %}
{% load widget_tweaks %}

{% block title %}Lista de Artículos{% endblock %}

{% block content %}
<h2 class="mb-4">Lista de Artículos</h2>

<a class="btn btn-institucional mb-3" href="{% url 'agregar_articulo' %}">Agregar Artículo</a>

<form method="get" class="row g-2 mb-4 align-items-center">
  <div class="col-auto">
    <label for="buscar" class="form-label mb-0">Buscar:</label>
  </div>
  <div class="col-auto">
    <input type="text"
           name="q"
           id="buscar"
           class="form-control"
           value="{{ query }}"
           placeholder="CÓDIGO O DESCRIPCIÓN"
           maxlength="80"
           oninput="this.value = this.value.toUpperCase();">
  </div>
  <div class="col-auto">
    <button type="submit" class="btn btn-sm btn-primary">Buscar</button>
    {% if query %}
      <a href="{% url 'lista_articulos' %}" class="btn btn-sm btn-secondary ms-1">Limpiar</a>
    {% endif %}
  </div>
</form>

<table class="table table-striped table-bordered align-middle">
  <thead class="table-light">
    <tr>
      <th style="width: 120px;">Código</th>
      <th style="width: 35%;">Descripción</th>
      <th class="text-end">Precio Costo</th>
      <th class="text-end">Margen</th>
      <th class="text-end">Precio Venta</th>
      <th class="text-end">% Alícuota</th>
      <th class="text-end">Costo con IVA</th>
      <th class="text-end">Precio Final</th>
      <th style="width: 150px;">Acciones</th>
    </tr>
  </thead>
  <tbody>
    {% for articulo in articulos %}
    <tr>
      <td>{{ articulo.codart }}</td>
      <td>{{ articulo.descrip }}</td>
      <td class="text-end">{{ articulo.precosto|floatformat:2 }}</td>
      <td class="text-end">{{ articulo.margen|floatformat:2 }}%</td>
      <td class="text-end">{{ articulo.preventa|floatformat:2 }}</td>
      <td class="text-end">{{ articulo.alic|floatformat:2 }}</td>
      <td class="text-end">{{ articulo.costoiva|floatformat:2 }}</td>
      <td class="text-end">
        {% if articulo.prefinal %}
          {{ articulo.prefinal|floatformat:2 }}
        {% else %}
          -
        {% endif %}
    </td>
	<td>
	  <div class="btn-group" role="group">
		<a href="{% url 'modificar_articulo' articulo.id %}" class="btn btn-sm btn-institucional">
		  <i class="bi bi-pencil-square"></i> Editar
		</a>
		<a href="{% url 'eliminar_articulo' articulo.id %}" 
		   class="btn btn-sm btn-institucional-danger"
		   onclick="return confirm('¿Está seguro que desea eliminar el artículo {{ articulo.descrip }}?');">
		  <i class="bi bi-trash3"></i> Eliminar
		</a>
	  </div>
	</td>
	</tr>
    {% empty %}
    <tr>
      <td colspan="9" class="text-center">No hay artículos cargados.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}



